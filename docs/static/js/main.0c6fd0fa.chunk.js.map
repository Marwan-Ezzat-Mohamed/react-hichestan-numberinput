{"version":3,"sources":["lib/NumberInput.js","Example.js","index.js"],"names":["NUMBER_FORMAT_FARSI","NUMBER_FORMAT_LATIN","lib_NumberInput","NumberInput","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","readValuesFromProps","value","valueToShow","mapValue","numberFormat","values","selectionStart","undefined","selectionEnd","handleKeyDown","event","keyCode","preventDefault","updateState","deleteValue","target","updateValue","toString","ctrlKey","handlePaste","enteredValue","stripAnyThingButDigits","clipboardData","window","getData","handleInput","recheckValue","mapToFarsi","mapToLatin","newState","inputRef","current","setSelectionRange","fireOnChange","element","enteredValueMapped","substring","length","qty","onChange","name","handleChange","React","createRef","nextProps","nextState","_this$props","rest","onInput","onPast","onKeyDown","pattern","inputMode","type","ref","objectWithoutProperties","react_default","a","createElement","assign","onPaste","Component","str","replace","e","String","fromCharCode","charCodeAt","Example","state","Number1","Number2","t","setState","console","log","handleValueChange","substr","Fragment","style","width","placeholder","render","margin","src_Example","document","getElementById"],"mappings":"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","file":"static/js/main.0c6fd0fa.chunk.js","sourcesContent":["import React, { Component } from 'react';\n\nexport const NUMBER_FORMAT_FARSI = 'FARSI';\nexport const NUMBER_FORMAT_LATIN = 'LATIN';\n\nclass NumberInput extends Component {\n\n  constructor(props) {\n    super(props);\n    this.inputRef = React.createRef();\n\n    this.readValuesFromProps(props);\n  }\n\n  readValuesFromProps = (props) => {\n    const value = props.value || '';\n    const valueToShow = this.mapValue(value, props.numberFormat);\n\n    this.values = {\n      value,\n      valueToShow,\n      selectionStart: undefined,\n      selectionEnd: undefined,\n    };\n  };\n\n  handleKeyDown = (event) => {\n    // console.log('keyCode: ', event.keyCode, 'key: ', event.key);\n    if(event.keyCode===8) { //backspace\n      event.preventDefault();\n      this.updateState(this.deleteValue(event.target, -1));\n    }else if(event.keyCode===46){ //delete\n      event.preventDefault();\n      this.updateState(this.deleteValue(event.target, 1));\n    }else if(event.keyCode>=48 && event.keyCode<=57){ //digits\n      event.preventDefault();\n      // console.log('digit');\n      this.updateState(this.updateValue(event.target, (event.keyCode - 48).toString(), this.props.numberFormat));\n    }else if(event.keyCode>=36 && event.keyCode<=40){ //arrows\n    }else if(event.keyCode===9){ //tab\n    }else if(event.ctrlKey && (event.keyCode===67 || event.keyCode===86)){ //copy/paste\n    }else if(event.keyCode===229){ //android bug workaround\n    }else{\n      // console.log('other');\n      // console.log('keyCode: ', event.keyCode, 'key: ', event.key, 'ctrlKey: ', event.ctrlKey);\n      event.preventDefault();\n    }\n  };\n\n  handlePaste = (event) => {\n    event.preventDefault();\n\n    const enteredValue = stripAnyThingButDigits((event.clipboardData || window.clipboardData).getData('text'));\n\n    this.updateState(this.updateValue(event.target, enteredValue, this.props.numberFormat));\n  };\n\n  handleInput = (event) => {\n    if(this.values.valueToShow===event.target.value) return;\n\n    const enteredValue = stripAnyThingButDigits(event.target.value);\n\n    this.updateState(this.recheckValue(event.target, enteredValue, this.props.numberFormat));\n  };\n\n  mapValue = (value, numberFormat) => {\n    if(numberFormat===NUMBER_FORMAT_FARSI){\n      return mapToFarsi(value);\n    }else if(numberFormat===NUMBER_FORMAT_LATIN){\n      return mapToLatin(value);\n    }\n    return mapToFarsi(value);\n  };\n\n\n  updateState = (newState) => {\n    if(!newState) return;\n\n    this.values = newState;\n    this.inputRef.current.value = this.values.valueToShow;\n    this.inputRef.current.setSelectionRange(this.values.selectionStart, this.values.selectionEnd);\n    this.fireOnChange();\n  };\n\n  updateValue = (element, enteredValue, numberFormat) => {\n    const enteredValueMapped = this.mapValue(enteredValue, numberFormat);\n    let valueToShow = element.value;\n    let selectionStart = element.selectionStart;\n    let selectionEnd = element.selectionEnd;\n\n    valueToShow = valueToShow.substring(0, selectionStart) + enteredValueMapped + valueToShow.substring(selectionEnd);\n\n    selectionStart += enteredValueMapped.length;\n    selectionEnd = selectionStart;\n\n    const value = mapToLatin(valueToShow);\n\n    return {\n      value,\n      valueToShow,\n      selectionStart,\n      selectionEnd,\n    };\n  };\n\n  recheckValue = (element, enteredValue, numberFormat) => {\n    let valueToShow = this.mapValue(enteredValue, numberFormat);\n    let selectionStart = element.selectionStart;\n    let selectionEnd = element.selectionEnd;\n\n    const value = mapToLatin(valueToShow);\n\n    return {\n      value,\n      valueToShow,\n      selectionStart,\n      selectionEnd,\n    };\n  };\n\n  deleteValue = (element, qty) => {\n    let valueToShow = element.value;\n    let selectionStart = element.selectionStart;\n    let selectionEnd = element.selectionEnd;\n\n    // console.log({selectionStart, selectionEnd})\n\n    if(selectionStart===selectionEnd){\n      if(qty < 0) {\n        if(selectionStart===0) return;\n        valueToShow = valueToShow.substring(0, selectionStart + qty) + valueToShow.substring(selectionEnd);\n        selectionStart += qty;\n      }else{\n        if(selectionEnd===valueToShow.length) return;\n        valueToShow = valueToShow.substring(0, selectionStart) + valueToShow.substring(selectionEnd+qty);\n      }\n    }else{\n      valueToShow = valueToShow.substring(0, selectionStart) + valueToShow.substring(selectionEnd);\n    }\n\n    selectionEnd = selectionStart;\n\n    const value = mapToLatin(valueToShow);\n\n    return {\n      value,\n      valueToShow,\n      selectionStart,\n      selectionEnd,\n    };\n  };\n\n  fireOnChange = () => {\n    if(this.props.onChange){\n      this.props.onChange({target: {name: this.props.name, value: this.values.value}});\n    }\n  };\n\n  handleChange = () => {\n    //we do not use the onChange, we use the keyPress and paste instead\n  };\n\n  shouldComponentUpdate(nextProps, nextState){\n    // if(nextProps.value !== this.values.value || nextProps.numberFormat !== this.props.numberFormat){\n    //   this.readValuesFromProps(nextProps);\n    //   return true;\n    // }\n    return false;\n  }\n\n  render() {\n    // console.log('rendered')\n\n    const {value, onChange, onInput, onPast, onKeyDown, pattern, inputMode, type, ref, numberFormat, ...rest} = this.props;\n    const {valueToShow} = this.values;\n\n    return (\n      <input\n        ref={this.inputRef}\n        type={\"text\"}\n        inputMode={\"numeric\"}\n        pattern={\"[0-9]*\"}\n        value={valueToShow}\n        onKeyDown={this.handleKeyDown}\n        onPaste={this.handlePaste}\n        onChange={this.handleChange}\n        onInput={this.handleInput}\n        {...rest}\n      />\n      );\n  }\n}\nexport default NumberInput;\n\n\nexport function mapToFarsi(str) {\n  if(!str) return str;\n  return str.toString().replace(/[1234567890]/gi, e => String.fromCharCode(e.charCodeAt(0) + 1728))\n}\n\nexport function mapToLatin(str) {\n  if(!str) return str;\n  return str.toString().replace(/[۱۲۳۴۵۶۷۸۹۰]/gi, e => String.fromCharCode(e.charCodeAt(0) - 1728))\n}\n\nexport function stripAnyThingButDigits(str) {\n  if(!str) return str;\n  return str.toString().replace(/[^1234567890۱۲۳۴۵۶۷۸۹۰]/gi, '');\n}\n","import React, { Component } from 'react';\nimport { NumberInput } from \"./lib\";\nimport {NUMBER_FORMAT_LATIN} from './lib/NumberInput';\n\nclass Example extends Component {\n  state = {\n    Number1: '',\n    Number2: '123',\n  };\n\n  handleChange = (event) => {\n    const newState = {};\n    const t = event.target;\n\n    newState[t.name] = t.value;\n    this.setState(newState, ()=>{\n      console.log('after', this.state)\n    });\n  };\n\n  handleValueChange = (event) => {\n    const newState = {};\n    const t = event.target;\n\n    newState[t.name.substr(0, 7)] = t.value;\n    this.setState(newState, ()=>{\n      console.log('after', this.state)\n    });\n  };\n\n  render(){\n    return (\n      <React.Fragment>\n        <div>\n          <br/>\n          <br/>\n          <br/>\n          <label>خروجی عدد لاتین\n            <br/>\n            <input type=\"text\" name=\"Number1_value\" style={{width: 250}} value={this.state.Number1} onChange={this.handleValueChange}  placeholder=\"از اینجا کلید تب را چند بار بزنید\" />\n          </label>\n          <br/>\n          <br/>\n          <label>\n            نمونه فارسی\n            <br/>\n            <NumberInput name=\"Number1\" value={this.state.Number1} onChange={this.handleChange} placeholder=\"type/paste a number\" />\n          </label>\n        </div>\n        <br/>\n        <div>\n          <label>\n            نمونه لاتین\n            <br/>\n            <NumberInput name=\"Number2\" value={this.state.Number2} numberFormat={NUMBER_FORMAT_LATIN} onChange={this.handleChange} placeholder=\"type/paste a number\" />\n          </label>\n        </div>\n        <br/>\n        <br/>\n        <label>خروجی\n          <br/>\n          <input type=\"text\" name=\"Number2_value\" style={{width: 250}} value={this.state.Number2} onChange={this.handleValueChange} placeholder=\"این فیلد خروجی است\" />\n        </label>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default Example;\n","import React from 'react';\nimport { render } from \"react-dom\";\nimport Example from './Example';\n\nconst App = () => (\n  <div style={{ width: 640, margin: \"15px auto\" }}>\n    <h1>Hello React</h1>\n\n    <Example/>\n\n  </div>\n);\n\nrender(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}